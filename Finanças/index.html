<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Momo+Trust+Display&display=swap" rel="stylesheet"> 
    
    <link rel="stylesheet" href="css/style.css"> 
    
    <title>Buscar CNPJ - Recadastramento</title>
</head>
<body>
    <div class="animated-background"></div> 

    <header class="main-header">
        <img src="imgs/logoprefeitura.png" alt="Logo do Sistema">
    </header>
    <div class="login-container">
        <h2>Verifica√ß√£o de CNPJ</h2>
        <form id="cnpjSearchForm">
            <div class="input-group">
                <label for="cnpj">CNPJ da Empresa</label>
                <input 
                    type="text" 
                    id="cnpj" 
                    name="cnpj" 
                    placeholder="00.000.000/0000-00" 
                    maxlength="18" 
                    required
                >
            </div>
            <button type="submit" id="searchButton">
                Buscar Dados da Empresa
            </button>
        </form>

        <div id="statusMessage" style="margin-top: 20px;">
            </div>

        <div id="companyData" style="margin-top: 20px; text-align: left; display: none;">
            <h3>Dados Encontrados:</h3>
            <p><strong>Raz√£o Social:</strong> <span id="razaoSocial"></span></p>
            <p><strong>Situa√ß√£o Cadastral:</strong> <span id="situacao"></span></p>
            <button id="goToRecadastro" style="margin-top: 20px;">
                Prosseguir para o Recadastramento
            </button>
        </div>
    </div>

    <script>
        const form = document.getElementById('cnpjSearchForm');
        const cnpjInput = document.getElementById('cnpj');
        const searchButton = document.getElementById('searchButton');
        const statusMessage = document.getElementById('statusMessage');
        const companyData = document.getElementById('companyData');
        const razaoSocialSpan = document.getElementById('razaoSocial');
        const situacaoSpan = document.getElementById('situacao');
        const goToRecadastroButton = document.getElementById('goToRecadastro');

        // Fun√ß√£o para formatar o CNPJ enquanto o usu√°rio digita
        cnpjInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, ''); // Remove tudo que n√£o √© d√≠gito
            value = value.replace(/^(\d{2})(\d)/, '$1.$2'); // 00.000
            value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3'); // 00.000.000
            value = value.replace(/\.(\d{3})(\d)/, '.$1/$2'); // 00.000.000/0000
            value = value.replace(/(\d{4})(\d)/, '$1-$2'); // 00.000.000/0000-00
            e.target.value = value.substring(0, 18);
        });

        // Simula√ß√£o da Chamada de API
        form.addEventListener('submit', async function(event) {
            event.preventDefault(); 

            // Limpa mensagens e dados anteriores
            statusMessage.innerHTML = '';
            companyData.style.display = 'none';
            searchButton.disabled = true;
            searchButton.textContent = 'Buscando...';
            
            // Remove formata√ß√£o para a chamada da API
            const rawCnpj = cnpjInput.value.replace(/\D/g, ''); 

            if (rawCnpj.length !== 14) {
                statusMessage.innerHTML = '<p style="color: red;">‚ö†Ô∏è CNPJ inv√°lido. Digite 14 d√≠gitos.</p>';
                searchButton.disabled = false;
                searchButton.textContent = 'Buscar Dados da Empresa';
                return;
            }

            try {
                // Endpoint da API ReceitaWS
                const apiUrl = `https://receitaws.com.br/v1/cnpj/${rawCnpj}`;
                statusMessage.innerHTML = '<p style="color: blue;">Aguarde, buscando dados na Receita Federal...</p>';

                const response = await fetch(apiUrl, { mode: 'cors' });
                const data = await response.json();

                if (data.status === 'ERROR' || data.situacao === 'BAIXADA') {
                    statusMessage.innerHTML = `<p style="color: red;">‚ùå Erro: ${data.message || 'CNPJ n√£o encontrado ou est√° baixado.'}</p>`;
                } else {
                    // Dados encontrados com sucesso!
                    razaoSocialSpan.textContent = data.nome || 'N√£o Informado';
                    situacaoSpan.textContent = data.situacao || 'Desconhecida';
                    
                    statusMessage.innerHTML = '<p style="color: green;">‚úÖ Sucesso! Dados carregados. Verifique abaixo.</p>';
                    companyData.style.display = 'block';

                    // Aqui voc√™ armazenaria os dados em um objeto global (ou estado do React) para uso na pr√≥xima tela
                    console.log('Dados completos do CNPJ:', data);
                }
            } catch (error) {
                statusMessage.innerHTML = `<p style="color: red;">üõë Erro de Conex√£o: Verifique sua rede.</p>`;
                console.error('Erro na chamada da API:', error);
            } finally {
                searchButton.disabled = false;
                searchButton.textContent = 'Buscar Dados da Empresa';
            }
        });

        // Simula√ß√£o de navega√ß√£o para a Tela 3
        goToRecadastroButton.addEventListener('click', function() {
            // Em um projeto real, voc√™ passaria os dados do 'data' para a tela de recadastro
            alert('Navegando para a Tela 3: Recadastramento...');
            // Exemplo: window.location.href = 'recadastro.html'; 
        });
    </script>
</body>
</html>